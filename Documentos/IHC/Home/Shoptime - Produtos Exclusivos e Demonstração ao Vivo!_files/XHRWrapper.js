/*
* Copyright 2010-2012 ClickTale Ltd.
*/
(function(){var aQ=!0,aP=null,aO=!1;function aN(i,j,g){return i.call.apply(i.bind,arguments)}function at(i,k,g){if(!i){throw Error()}if(2<arguments.length){var j=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(n,j);return i.apply(k,n)}}return function(){return i.apply(k,arguments)}}function aM(i,j,g){aM=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aN:at;return aM.apply(aP,arguments)}var aL;var aK;function aJ(){if(!aK){var g;aL?g=aL:(g=window.ClickTaleGlobal,g||(g={},window.ClickTaleGlobal=g),g.exports=g.exports||{},aL=g);g.exports.xhr=g.exports.xhr||{};aK=g.exports.xhr}return aK}function aR(i,j,g){Object.prototype.__defineGetter__&&!aI?("get" in g&&i.__defineGetter__(j,g.get),"set" in g&&i.__defineSetter__(j,g.set)):Object.defineProperty&&Object.defineProperty(i,j,g)}var aI;try{aI=Object.defineProperty({},"x",{get:function(){return aQ}}).x}catch(ax){aI=aO}var aH;function aG(){}var aF=aP,aE=aP,aD=50000,aC=aI||Object.prototype.__defineGetter__?1:2;var ay=0,aB=aP;function aA(i,k,g){try{return i[k]}catch(j){return g}}var ar=aO,aq="";function ap(){}var ao={};function an(g,i){aR(i,g,{get:function(){return this.x[g]},set:function(j){this.x[g]=j},enumerable:aQ,configurable:aQ})}function am(i,k){var g=new Function("a","b","c","d","e","f","g","h",'return this["x"].'+i+"(a,b,c,d,e,f,g,h);");if(2==aC){var j=g,g=function(p,o,u,s,n,t,q,r){al(this,this.x,ak);return j.call(this,p,o,u,s,n,t,q,r)}}k[i]=g}function aj(i){var k=ai.prototype,g;for(g in i){if("string"==typeof g&&ao[g]!==ap){try{"function"==typeof i[g]?(am(g,k),ao[g]=ap):1===aC&&(an(g,k),ao[g]=ap)}catch(j){ao[g]=ap,1===aC&&an(g,k)}}}}function al(i,o,g){for(var n=g.length,k,j;n--;){j=g[n],k=j[0],j=aA(i,k,j[1]),o[k]=j}}var ah=[["status",""],["timeout",0],["responseXML",aP],["responseBody",aP],["readyState",0],["responseText",aP],["statusText",aP]],ak=[["ontimeout",aP]];function ag(){var g=aH;return !!g&&!!g.g&&0<g.g.length}function ai(){var g=new ai.OriginalXMLHttpRequest;this.x=g;this.q=ay++;g.onreadystatechange=aM(au,this);ar||(aj(g),ar=aQ);2==aC&&(al(g,this,ah),al(g,this,ak))}function au(){var s=this.x,q=this.B,r=this.skip;2==aC&&al(s,this,ah);var p=aA(s,"readyState",0),o=aA(s,"status",0),n=aA(s,"statusText",""),i=aA(s,"responseText",""),k=this.headersToRecord;if(!r&&q!=p){if(0<p&&4>p){aB.readyState(this.q,p)}else{if(4==p){var g=[];if(k&&"number"==typeof k.length){for(r=k.length;0<r--;){q=k[r],g.push(q+":"+s.getResponseHeader.call(s,q))}}else{k=aP;try{k=this.getAllResponseHeaders()}catch(j){}g=k!=aP&&0<k.length?k.split("\n"):["Error: headers are null"]}o={status:o,statusText:n,headers:g,responseText:i};aF&&aF(o);o.responseText&&o.responseText.length>aD&&(o.responseText="",o.statusText="responseText is larger than MaxResponseSize");n=aP;i=aO;k=this.urlRule;ag()&&k&&(n=s.getResponseHeader.call(s,"X-ClickTale-IMToken"),i=k.w);aB.i(this.q,o.status,o.statusText,o.headers,o.responseText,n,i)}}}this.B=p;return"function"!=typeof this.onreadystatechange?void 0:this.onreadystatechange.apply(this,[])}ai.prototype.open=function(i,o,g,n,k){var j=this.x;"undefined"==typeof g&&(g=aQ);aE&&aE(i,o)==aO?this.skip=aQ:aB.open(this.q,o,i.toUpperCase());i=j.open(i,o,g,n,k);this.urlRule=aP;if(ag()){g=aP;n=aH.g;for(k=0;k<n.length;k++){if(j=n[k],j.n instanceof RegExp&&j.n.test(o)||o==j.n){g=j;break}}if(o=g){this.urlRule=o,g=this.x,g.setRequestHeader.call(g,"X-ClickTale-IMCache","1"),o.s&&g.setRequestHeader.call(g,"X-ClickTale-IMRuleSet",o.s)}}return i};ao.open=ap;ao.onreadystatechange=ap;ai.prototype.skip=aO;function af(){this.b=aP;this.d=[]}af.prototype.b=aP;af.prototype.open=function(i,j,g){this.b!=aP?this.b.open(i,j,g):this.d.push([this.open,[i,j,g]])};af.prototype.readyState=function(g,i){this.b!=aP?this.b.readyState(g,i):this.d.push([this.readyState,[g,i]])};af.prototype.i=function(j,p,g,o,n,k,i){this.b!=aP?this.b.i(j,p,g,o,n,k,i):this.d.push([this.i,[j,p,g,o,n,k,i]])};af.prototype.d=[];function ae(i,k,g,j){this.p=i;this.o=k;this.z=g;this.A=j}ae.GET=1;ae.HEAD=2;ae.POST=3;ae.OPTIONS=4;ae.PUT=5;ae.DELETE=6;ae.prototype.open=function(i,k,g){var g=ae[g],j={a:"xhropen"};j.xhrid=i;j.u=k;j.methodid=g;j.t=this.o();this.p(j)};ae.prototype.readyState=function(i,j){var g={a:"xhrstate"};g.xhrid=i;g.stateid=j;g.t=this.o();this.p(g)};ae.prototype.i=function(r,p,q,o,n,k,i){var j=k&&k.length,g={v:1};g.h=o;j||(g.c=n);n=this.z(this.A(g));o={a:"xhrstatedone"};o.xhrid=r;o.status=p;o.statusText=q;o.streamid=n;o.t=this.o();if(j){o.a="xhrstatedoneim";if(!aq||0==aq.length){if((r=window.ClickTaleFetchFrom)&&0<r.length){(p=/\?[th]=(\w+)/ig.exec(r))&&(p=p[1]),aq=r=r.replace(p,"")}}o.fetchUrl=aq+k;o.fetcherDoRewriteRules=!!i}this.p(o)};function a(){var g=ad;ai.OriginalXMLHttpRequest=ac;ai.RegisterRecorderFunction=g;ai.ClickTaleWrapperVersion=1;ai.addMethodDelegation=function(i){am(i,ai.prototype)}}function az(g){am(g,ai.prototype)}var ab=aP;function Q(){ab===aP&&(ab=new af);return ab}function av(){var g=m,i=l.f,g=g||window;if(g.XMLHttpRequest){if(!i){return g=g.XMLHttpRequest,i=g.constructor,g=(i?i:g).toString(),!(-1===g.indexOf("[native code]")&&-1===g.indexOf("[object XMLHttpRequest]"))?aO:aQ}}else{return aO}return !!i()}function ad(i,n,g){n=new ae(i,n,g,aG);i=Q();i.b=n;for(var n=i.d.length,g=i.d,k,j=0;j<n;j++){k=g[j],k[0].apply(i,k[1])}}var m=window,l=void 0,l=function(){var i=m,o=i.ClickTaleSettings,g={};"object"!=typeof o&&(o={});"object"!=typeof o.XHRWrapper&&(o.XHRWrapper={});o=o.XHRWrapper;g.e=o.Enable;g.k=o.MaxResponseSize;g.l=o.RequestFilter;g.m=o.ResponseFilter;g.j=o.JSONStringify;g.f=o.Override;var n=aP;if(n=o.IM){if(g.r={g:[]},o=aP,(o=n.Urls)&&o.length){for(n=0;n<o.length;n++){var k=o[n];g.r.g.push({n:k.UrlRule,w:k.FetcherDoRewriteRules,s:k.IMRewriteRulesSet})}}}var j=g.f;"boolean"===typeof j?g.f=function(){return j}:"function"!==typeof j&&(g.f=aP);"boolean"!=typeof g.e&&(g.e=aO);"number"!=typeof g.k&&(g.k=50000);"function"!=typeof g.l&&(g.l=function(){return aQ});"function"!=typeof g.m&&(g.m=function(){});"function"!=typeof g.j&&(i.JSON&&"function"==typeof i.JSON.stringify?g.j=i.JSON.stringify:g.e=aO);return g}();if(l.e&&av()){var d=m;if(!("number"==typeof aJ().v||"number"==typeof(d||window).XMLHttpRequest.ClickTaleWrapperVersion)&&l.e){for(var h=m,f=l,ac=h.XMLHttpRequest,e=ai.prototype,c=["setRequestHeader","send","abort","getAllResponseHeaders","getResponseHeader"],b=c.length;b--;){am(c[b],e),ao[c[b]]=ap}if(1===aC){c="responseXML,responseText,statusText,status,readyState,responseType".split(",");for(b=c.length;b--;){an(c[b],e),ao[c[b]]=ap}}aj(h.XMLHttpRequest.prototype);aB=Q();aF=f.m;aE=f.l;aD=f.k;aG=f.j;aH=f.r;var aw=aJ();aw.v=1;aw.registerRecorderFunctionAPI=ad;aw.originalXHR=ac;aw.addMethodDelegation=az;a();m.XMLHttpRequest=ai}}})();